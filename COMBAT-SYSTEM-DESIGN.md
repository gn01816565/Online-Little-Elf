# âš”ï¸ æˆ°é¬¥ç³»çµ±è¨­è¨ˆæ–‡ä»¶ - æ”»æ“Šèˆ‡é˜²ç¦¦æ©Ÿåˆ¶

## ğŸ¯ è¨­è¨ˆç†å¿µ

è®“å°ç²¾éˆéŠæˆ²ä¸åªæ˜¯ã€Œåƒè±†å­ã€ï¼Œè€Œæ˜¯åŠ å…¥**ç­–ç•¥æ€§çš„æˆ°é¬¥å…ƒç´ **ï¼š
- ğŸ—¡ï¸ æ”»æ“Šï¼šä¸»å‹•å‡ºæ“Šæ¶å¥ªå°æ‰‹åˆ†æ•¸
- ğŸ›¡ï¸ é˜²ç¦¦ï¼šä¿è­·è‡ªå·±é¿å…è¢«æ”»æ“Š
- ğŸ² ç­–ç•¥ï¼šä½•æ™‚æ”»æ“Šã€ä½•æ™‚é˜²å®ˆçš„æ±ºç­–

---

## ğŸ’¥ æ ¸å¿ƒç¢°æ’æ©Ÿåˆ¶

### åŸºç¤è¦å‰‡ï¼šçŸ³é ­å‰ªåˆ€å¸ƒç³»çµ±

```
æ”»æ“Šç‹€æ…‹ï¼ˆç´…è‰²ï¼‰ > æ™®é€šç‹€æ…‹ï¼ˆé»ƒè‰²ï¼‰ > é˜²ç¦¦ç‹€æ…‹ï¼ˆè—è‰²ï¼‰ > æ”»æ“Šç‹€æ…‹ï¼ˆç´…è‰²ï¼‰

ğŸ—¡ï¸ æ”»æ“Šç‹€æ…‹ â†’ å°ä»˜æ™®é€šç©å®¶
   - ç¢°åˆ°æ™®é€šç©å®¶ï¼šæ¶èµ° 30% åˆ†æ•¸
   - ç¢°åˆ°é˜²ç¦¦ç©å®¶ï¼šè‡ªå·±è¢«åå½ˆï¼Œæ‰£ 10% åˆ†æ•¸
   - ç¢°åˆ°æ”»æ“Šç©å®¶ï¼šé›™æ–¹æ‰£ 15% åˆ†æ•¸ï¼ˆäº’ç›¸å‚·å®³ï¼‰

ğŸŸ¡ æ™®é€šç‹€æ…‹ â†’ éˆæ´»ç§»å‹•
   - ç¢°åˆ°æ”»æ“Šç©å®¶ï¼šè¢«æ¶èµ° 30% åˆ†æ•¸
   - ç¢°åˆ°é˜²ç¦¦ç©å®¶ï¼šæ²’äº‹ç™¼ç”Ÿ
   - ç¢°åˆ°æ™®é€šç©å®¶ï¼šæ¶èµ° 10% åˆ†æ•¸ï¼ˆçœ‹èª°åˆ†æ•¸é«˜ï¼‰

ğŸ›¡ï¸ é˜²ç¦¦ç‹€æ…‹ â†’ ä¿è­·è‡ªå·±
   - ç¢°åˆ°æ”»æ“Šç©å®¶ï¼šåå½ˆæ”»æ“Šï¼Œå°æ–¹æ‰£ 10% åˆ†æ•¸
   - ç¢°åˆ°æ™®é€šç©å®¶ï¼šæ²’äº‹ç™¼ç”Ÿ
   - ç¢°åˆ°é˜²ç¦¦ç©å®¶ï¼šæ²’äº‹ç™¼ç”Ÿ
   - ä»£åƒ¹ï¼šç§»å‹•é€Ÿåº¦ -30%
```

### å°ç…§è¡¨

| ç¢°æ’çµ„åˆ | æ”»æ“Šæ–¹çµæœ | é˜²å®ˆæ–¹çµæœ | è¦–è¦ºæ•ˆæœ |
|---------|----------|----------|---------|
| æ”»æ“Š vs æ™®é€š | +30%åˆ†æ•¸ | -30%åˆ†æ•¸ | ç´…è‰²é–ƒå…‰ + æ“Šé£›å‹•ç•« |
| æ”»æ“Š vs é˜²ç¦¦ | -10%åˆ†æ•¸ | 0 | è—è‰²è­·ç›¾åå½ˆ |
| æ”»æ“Š vs æ”»æ“Š | -15%åˆ†æ•¸ | -15%åˆ†æ•¸ | é›™æ–¹çˆ†ç‚¸æ•ˆæœ |
| æ™®é€š vs æ™®é€š | åˆ†é«˜è€… +10% | åˆ†ä½è€… -10% | å°ç¢°æ’å‹•ç•« |
| æ™®é€š vs é˜²ç¦¦ | 0 | 0 | å½ˆé–‹ |
| é˜²ç¦¦ vs é˜²ç¦¦ | 0 | 0 | ç¢°æ’å½ˆé–‹ |

---

## ğŸ® ç‹€æ…‹åˆ‡æ›æ©Ÿåˆ¶

### ä¸‰ç¨®ç‹€æ…‹èˆ‡åˆ‡æ›æ–¹å¼

```javascript
// ç©å®¶ç‹€æ…‹
playerState = {
    mode: 'normal',  // 'normal' | 'attack' | 'defense'
    modeDuration: 0, // ç‹€æ…‹æŒçºŒæ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
    cooldown: 0      // å†·å»æ™‚é–“
}

// ç‹€æ…‹é…ç½®
const stateConfig = {
    normal: {
        color: '#FFD700',      // é‡‘é»ƒè‰²
        speed: 1.0,            // æ­£å¸¸é€Ÿåº¦
        canSwitch: true        // å¯ä»¥åˆ‡æ›ç‹€æ…‹
    },
    attack: {
        color: '#FF4444',      // ç´…è‰²
        speed: 1.2,            // é€Ÿåº¦ +20%
        duration: 5000,        // æŒçºŒ 5 ç§’
        cooldown: 10000,       // å†·å» 10 ç§’
        visual: 'flame'        // ç«ç„°ç‰¹æ•ˆ
    },
    defense: {
        color: '#4444FF',      // è—è‰²
        speed: 0.7,            // é€Ÿåº¦ -30%
        duration: 5000,        // æŒçºŒ 5 ç§’
        cooldown: 8000,        // å†·å» 8 ç§’
        visual: 'shield'       // è­·ç›¾ç‰¹æ•ˆ
    }
}
```

### æ“ä½œæ–¹å¼

```
éµç›¤æ§åˆ¶ï¼š
- ç§»å‹•ï¼šæ–¹å‘éµ / WASD
- æ”»æ“Šç‹€æ…‹ï¼šæŒ‰ Q éµï¼ˆæŒçºŒ 5 ç§’ï¼Œå†·å» 10 ç§’ï¼‰
- é˜²ç¦¦ç‹€æ…‹ï¼šæŒ‰ E éµï¼ˆæŒçºŒ 5 ç§’ï¼Œå†·å» 8 ç§’ï¼‰
- å¿«é€Ÿåˆ‡å›æ™®é€šï¼šæŒ‰ ç©ºç™½éµ

æ‰‹æ©Ÿæ§åˆ¶ï¼š
- ç§»å‹•ï¼šè™›æ“¬æ–æ¡¿
- æ”»æ“Š/é˜²ç¦¦ï¼šè¢å¹•å·¦å³å…©å´å¤§æŒ‰éˆ•
```

---

## ğŸ¨ è¦–è¦ºè¨­è¨ˆ

### 1. ç‹€æ…‹é¡¯ç¤º

#### ç©å®¶å¤–è§€è®ŠåŒ–
```javascript
// æ™®é€šç‹€æ…‹
{
    body: '#FFD700',        // é‡‘é»ƒè‰²èº«é«”
    outline: 'none',        // ç„¡å¤–æ¡†
    size: 1.0,              // æ­£å¸¸å¤§å°
    effect: 'none'          // ç„¡ç‰¹æ•ˆ
}

// æ”»æ“Šç‹€æ…‹
{
    body: '#FF4444',        // ç´…è‰²èº«é«”
    outline: '#FF0000',     // æ·±ç´…å¤–æ¡†
    size: 1.1,              // ç¨å¾®è®Šå¤§
    effect: 'flame',        // ç«ç„°ç²’å­ç’°ç¹
    aura: 'red-glow'        // ç´…è‰²å…‰æšˆ
}

// é˜²ç¦¦ç‹€æ…‹
{
    body: '#4444FF',        // è—è‰²èº«é«”
    outline: '#0000FF',     // æ·±è—å¤–æ¡†
    size: 1.0,              // æ­£å¸¸å¤§å°
    effect: 'shield',       // å…­é‚Šå½¢è­·ç›¾
    aura: 'blue-glow'       // è—è‰²å…‰æšˆ
}
```

#### Canvas ç¹ªè£½ç¨‹å¼ç¢¼
```javascript
function drawPlayer(player) {
    const x = player.x * CELL_SIZE + CELL_SIZE / 2;
    const y = player.y * CELL_SIZE + CELL_SIZE / 2;
    const radius = CELL_SIZE / 2 - 2;

    // ç¹ªè£½å…‰æšˆï¼ˆä¾ç‹€æ…‹ï¼‰
    if (player.mode === 'attack') {
        drawGlow(x, y, radius * 1.5, 'rgba(255, 68, 68, 0.3)');
    } else if (player.mode === 'defense') {
        drawGlow(x, y, radius * 1.3, 'rgba(68, 68, 255, 0.3)');
    }

    // ç¹ªè£½ç²’å­ç‰¹æ•ˆ
    if (player.mode === 'attack') {
        drawFlameParticles(x, y, radius);
    } else if (player.mode === 'defense') {
        drawShield(x, y, radius);
    }

    // ç¹ªè£½ä¸»é«”
    ctx.fillStyle = player.color;
    ctx.beginPath();
    ctx.arc(x, y, radius, 0, Math.PI * 2);
    ctx.fill();

    // ç¹ªè£½å¤–æ¡†ï¼ˆæ”»æ“Š/é˜²ç¦¦ç‹€æ…‹ï¼‰
    if (player.mode !== 'normal') {
        ctx.strokeStyle = player.mode === 'attack' ? '#FF0000' : '#0000FF';
        ctx.lineWidth = 3;
        ctx.stroke();
    }

    // ç¹ªè£½çœ¼ç›
    drawEyes(x, y, radius);
}

// å…‰æšˆæ•ˆæœ
function drawGlow(x, y, radius, color) {
    const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
    gradient.addColorStop(0, color);
    gradient.addColorStop(1, 'transparent');
    ctx.fillStyle = gradient;
    ctx.fillRect(x - radius, y - radius, radius * 2, radius * 2);
}

// ç«ç„°ç²’å­
function drawFlameParticles(x, y, radius) {
    const particles = 8;
    const time = Date.now() / 100;

    for (let i = 0; i < particles; i++) {
        const angle = (i / particles) * Math.PI * 2 + time;
        const distance = radius + 5 + Math.sin(time + i) * 3;
        const px = x + Math.cos(angle) * distance;
        const py = y + Math.sin(angle) * distance;

        ctx.fillStyle = `rgba(255, ${100 + Math.random() * 100}, 0, 0.7)`;
        ctx.beginPath();
        ctx.arc(px, py, 2, 0, Math.PI * 2);
        ctx.fill();
    }
}

// è­·ç›¾æ•ˆæœï¼ˆå…­é‚Šå½¢ï¼‰
function drawShield(x, y, radius) {
    const sides = 6;
    const shieldRadius = radius + 8;
    const time = Date.now() / 1000;

    ctx.strokeStyle = '#4444FF';
    ctx.lineWidth = 3;
    ctx.globalAlpha = 0.6 + Math.sin(time * 3) * 0.2;

    ctx.beginPath();
    for (let i = 0; i <= sides; i++) {
        const angle = (i / sides) * Math.PI * 2 - Math.PI / 2 + time;
        const px = x + Math.cos(angle) * shieldRadius;
        const py = y + Math.sin(angle) * shieldRadius;

        if (i === 0) {
            ctx.moveTo(px, py);
        } else {
            ctx.lineTo(px, py);
        }
    }
    ctx.closePath();
    ctx.stroke();

    ctx.globalAlpha = 1.0;
}
```

### 2. UI ç‹€æ…‹æŒ‡ç¤ºå™¨

```html
<!-- ç©å®¶è¡€æ¢èˆ‡æŠ€èƒ½å†·å» -->
<div class="player-status-bar">
    <div class="player-info">
        <span class="player-name">ç©å®¶åç¨±</span>
        <span class="player-score">1500</span>
    </div>

    <div class="skill-buttons">
        <!-- æ”»æ“ŠæŠ€èƒ½ -->
        <button class="skill-btn attack" id="attackBtn">
            <div class="skill-icon">ğŸ—¡ï¸</div>
            <div class="skill-name">æ”»æ“Š</div>
            <div class="cooldown-overlay" id="attackCooldown"></div>
            <div class="cooldown-text">10s</div>
        </button>

        <!-- é˜²ç¦¦æŠ€èƒ½ -->
        <button class="skill-btn defense" id="defenseBtn">
            <div class="skill-icon">ğŸ›¡ï¸</div>
            <div class="skill-name">é˜²ç¦¦</div>
            <div class="cooldown-overlay" id="defenseCooldown"></div>
            <div class="cooldown-text">8s</div>
        </button>
    </div>

    <!-- ç•¶å‰ç‹€æ…‹é¡¯ç¤º -->
    <div class="current-state" id="currentState">
        <span class="state-icon">ğŸŸ¡</span>
        <span class="state-name">æ™®é€š</span>
        <div class="state-timer">-</div>
    </div>
</div>

<style>
.player-status-bar {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    border-radius: 15px;
    padding: 15px 30px;
    display: flex;
    align-items: center;
    gap: 30px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
}

.player-info {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.player-name {
    color: #FFD700;
    font-weight: bold;
}

.player-score {
    color: white;
    font-size: 1.5em;
}

.skill-buttons {
    display: flex;
    gap: 15px;
}

.skill-btn {
    position: relative;
    width: 80px;
    height: 80px;
    border-radius: 10px;
    border: 3px solid;
    background: rgba(255, 255, 255, 0.1);
    cursor: pointer;
    transition: all 0.3s;
    overflow: hidden;
}

.skill-btn.attack {
    border-color: #FF4444;
}

.skill-btn.defense {
    border-color: #4444FF;
}

.skill-btn:hover:not(.on-cooldown) {
    transform: scale(1.1);
    box-shadow: 0 0 20px currentColor;
}

.skill-btn.active {
    animation: pulse 0.5s infinite;
}

.skill-icon {
    font-size: 2em;
}

.skill-name {
    font-size: 0.8em;
    color: white;
    margin-top: 5px;
}

.cooldown-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 0%;
    background: rgba(0, 0, 0, 0.7);
    transition: height 0.1s linear;
}

.skill-btn.on-cooldown {
    opacity: 0.5;
    cursor: not-allowed;
}

.cooldown-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    font-size: 1.2em;
    display: none;
}

.skill-btn.on-cooldown .cooldown-text {
    display: block;
}

.current-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    min-width: 100px;
}

.state-icon {
    font-size: 2em;
}

.state-name {
    color: white;
    font-weight: bold;
}

.state-timer {
    color: #FFD700;
    font-size: 1.2em;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}
</style>
```

---

## ğŸ’¥ ç¢°æ’æ•ˆæœå‹•ç•«

### 1. æ”»æ“ŠæˆåŠŸï¼ˆæ¶åˆ†ï¼‰
```javascript
function showAttackEffect(attackerPos, defenderPos, stolenScore) {
    // æ“Šä¸­ç‰¹æ•ˆ
    createImpactEffect(defenderPos, '#FF4444');

    // åˆ†æ•¸é£›å‘æ”»æ“Šè€…
    createScoreFly(defenderPos, attackerPos, stolenScore);

    // è¢«æ”»æ“Šè€…æ“Šé€€
    knockback(defenderPos, attackerPos);

    // éŸ³æ•ˆ
    playSound('attack-hit');

    // è¢å¹•éœ‡å‹•
    shakeScreen(5);
}

// æ’æ“Šç‰¹æ•ˆ
function createImpactEffect(pos, color) {
    const particles = 12;
    for (let i = 0; i < particles; i++) {
        const angle = (i / particles) * Math.PI * 2;
        const particle = {
            x: pos.x,
            y: pos.y,
            vx: Math.cos(angle) * 3,
            vy: Math.sin(angle) * 3,
            life: 30,
            color: color
        };
        gameParticles.push(particle);
    }
}

// åˆ†æ•¸é£›è¡Œå‹•ç•«
function createScoreFly(from, to, score) {
    const element = document.createElement('div');
    element.className = 'score-fly';
    element.textContent = `+${score}`;
    element.style.left = `${from.x * CELL_SIZE}px`;
    element.style.top = `${from.y * CELL_SIZE}px`;

    document.getElementById('gameCanvas').parentElement.appendChild(element);

    // ä½¿ç”¨ CSS å‹•ç•«é£›å‘ç›®æ¨™
    setTimeout(() => {
        element.style.left = `${to.x * CELL_SIZE}px`;
        element.style.top = `${to.y * CELL_SIZE}px`;
        element.style.opacity = '0';
    }, 10);

    setTimeout(() => element.remove(), 1000);
}

// æ“Šé€€æ•ˆæœ
function knockback(targetPos, sourcePos) {
    const dx = targetPos.x - sourcePos.x;
    const dy = targetPos.y - sourcePos.y;
    const distance = Math.sqrt(dx * dx + dy * dy);

    if (distance > 0) {
        const knockbackDistance = 2;
        const newX = targetPos.x + Math.round((dx / distance) * knockbackDistance);
        const newY = targetPos.y + Math.round((dy / distance) * knockbackDistance);

        // æª¢æŸ¥æ–°ä½ç½®æ˜¯å¦æœ‰æ•ˆ
        if (isValidPosition(newX, newY)) {
            // æ›´æ–°ä½ç½®ï¼ˆå¸¶å‹•ç•«ï¼‰
            animateMove(targetPos, {x: newX, y: newY}, 200);
        }
    }
}
```

**CSS å‹•ç•«**ï¼š
```css
.score-fly {
    position: absolute;
    color: #FF4444;
    font-size: 2em;
    font-weight: bold;
    pointer-events: none;
    transition: all 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 1000;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

/* è¢å¹•éœ‡å‹• */
@keyframes screen-shake {
    0%, 100% { transform: translate(0, 0); }
    10% { transform: translate(-5px, 2px); }
    20% { transform: translate(5px, -2px); }
    30% { transform: translate(-3px, -3px); }
    40% { transform: translate(3px, 3px); }
    50% { transform: translate(-2px, -1px); }
    60% { transform: translate(2px, 1px); }
    70% { transform: translate(-1px, -2px); }
    80% { transform: translate(1px, 2px); }
    90% { transform: translate(-1px, 1px); }
}

.shake {
    animation: screen-shake 0.3s;
}
```

### 2. é˜²ç¦¦æˆåŠŸï¼ˆåå½ˆï¼‰
```javascript
function showDefenseEffect(defenderPos, attackerPos) {
    // è­·ç›¾é–ƒå…‰
    createShieldFlash(defenderPos);

    // åå½ˆæ³¢ç´‹
    createReflectWave(defenderPos);

    // æ”»æ“Šè€…è¢«å½ˆé–‹
    knockback(attackerPos, defenderPos);

    // éŸ³æ•ˆ
    playSound('shield-block');

    // è­·ç›¾éœ‡å‹•
    shakeElement(defenderElement, 3);
}

// è­·ç›¾é–ƒå…‰
function createShieldFlash(pos) {
    const flash = document.createElement('div');
    flash.className = 'shield-flash';
    flash.style.left = `${pos.x * CELL_SIZE - 20}px`;
    flash.style.top = `${pos.y * CELL_SIZE - 20}px`;

    document.getElementById('gameCanvas').parentElement.appendChild(flash);

    setTimeout(() => flash.remove(), 500);
}

// åå½ˆæ³¢ç´‹
function createReflectWave(pos) {
    const wave = document.createElement('div');
    wave.className = 'reflect-wave';
    wave.style.left = `${pos.x * CELL_SIZE}px`;
    wave.style.top = `${pos.y * CELL_SIZE}px`;

    document.getElementById('gameCanvas').parentElement.appendChild(wave);

    setTimeout(() => wave.remove(), 600);
}
```

**CSS å‹•ç•«**ï¼š
```css
.shield-flash {
    position: absolute;
    width: 60px;
    height: 60px;
    background: radial-gradient(circle, rgba(68, 68, 255, 0.8), transparent);
    border-radius: 50%;
    animation: flash-expand 0.5s ease-out;
    pointer-events: none;
    z-index: 999;
}

@keyframes flash-expand {
    0% {
        transform: scale(0.5);
        opacity: 1;
    }
    100% {
        transform: scale(2);
        opacity: 0;
    }
}

.reflect-wave {
    position: absolute;
    width: 20px;
    height: 20px;
    border: 3px solid #4444FF;
    border-radius: 50%;
    animation: wave-expand 0.6s ease-out;
    pointer-events: none;
    z-index: 998;
}

@keyframes wave-expand {
    0% {
        transform: translate(-10px, -10px) scale(1);
        opacity: 1;
    }
    100% {
        transform: translate(-50px, -50px) scale(5);
        opacity: 0;
    }
}
```

### 3. é›™æ–¹æ”»æ“Šç¢°æ’ï¼ˆäº’ç›¸å‚·å®³ï¼‰
```javascript
function showMutualDamage(pos1, pos2) {
    // ä¸­é»çˆ†ç‚¸
    const midX = (pos1.x + pos2.x) / 2;
    const midY = (pos1.y + pos2.y) / 2;

    createExplosion({x: midX, y: midY});

    // é›™æ–¹éœ‡å‹•
    shakeScreen(8);

    // éŸ³æ•ˆ
    playSound('clash');

    // é›™æ–¹æ“Šé€€
    knockback(pos1, pos2);
    knockback(pos2, pos1);
}

// çˆ†ç‚¸æ•ˆæœ
function createExplosion(pos) {
    const explosion = document.createElement('div');
    explosion.className = 'explosion';
    explosion.style.left = `${pos.x * CELL_SIZE}px`;
    explosion.style.top = `${pos.y * CELL_SIZE}px`;

    document.getElementById('gameCanvas').parentElement.appendChild(explosion);

    // ç²’å­çˆ†ç‚¸
    const particles = 20;
    for (let i = 0; i < particles; i++) {
        const angle = (i / particles) * Math.PI * 2;
        const speed = 4 + Math.random() * 3;
        const particle = {
            x: pos.x,
            y: pos.y,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            life: 40,
            color: ['#FF4444', '#FF6600', '#FFAA00'][Math.floor(Math.random() * 3)]
        };
        gameParticles.push(particle);
    }

    setTimeout(() => explosion.remove(), 800);
}
```

**CSS å‹•ç•«**ï¼š
```css
.explosion {
    position: absolute;
    width: 40px;
    height: 40px;
    background: radial-gradient(circle, #FF4444, #FF6600, transparent);
    border-radius: 50%;
    animation: explode 0.8s ease-out;
    pointer-events: none;
    z-index: 1000;
}

@keyframes explode {
    0% {
        transform: translate(-20px, -20px) scale(0);
        opacity: 1;
    }
    50% {
        transform: translate(-40px, -40px) scale(2);
        opacity: 0.8;
    }
    100% {
        transform: translate(-60px, -60px) scale(3);
        opacity: 0;
    }
}
```

---

## ğŸ® å®Œæ•´å¯¦ä½œç¨‹å¼ç¢¼

### ç©å®¶ç‹€æ…‹ç®¡ç†
```javascript
class PlayerState {
    constructor() {
        this.mode = 'normal';
        this.modeStartTime = 0;
        this.attackCooldown = 0;
        this.defenseCooldown = 0;
    }

    // åˆ‡æ›æ”»æ“Šç‹€æ…‹
    switchToAttack() {
        if (this.mode !== 'normal' || this.attackCooldown > 0) {
            return false;
        }

        this.mode = 'attack';
        this.modeStartTime = Date.now();
        this.attackCooldown = 10000; // 10ç§’å†·å»

        // æ›´æ–°è¦–è¦º
        updatePlayerVisual('attack');

        // 5ç§’å¾Œè‡ªå‹•åˆ‡å›æ™®é€š
        setTimeout(() => {
            if (this.mode === 'attack') {
                this.switchToNormal();
            }
        }, 5000);

        return true;
    }

    // åˆ‡æ›é˜²ç¦¦ç‹€æ…‹
    switchToDefense() {
        if (this.mode !== 'normal' || this.defenseCooldown > 0) {
            return false;
        }

        this.mode = 'defense';
        this.modeStartTime = Date.now();
        this.defenseCooldown = 8000; // 8ç§’å†·å»

        // æ›´æ–°è¦–è¦º
        updatePlayerVisual('defense');

        // 5ç§’å¾Œè‡ªå‹•åˆ‡å›æ™®é€š
        setTimeout(() => {
            if (this.mode === 'defense') {
                this.switchToNormal();
            }
        }, 5000);

        return true;
    }

    // åˆ‡å›æ™®é€šç‹€æ…‹
    switchToNormal() {
        this.mode = 'normal';
        this.modeStartTime = 0;

        // æ›´æ–°è¦–è¦º
        updatePlayerVisual('normal');
    }

    // æ›´æ–°å†·å»æ™‚é–“
    updateCooldowns(deltaTime) {
        if (this.attackCooldown > 0) {
            this.attackCooldown = Math.max(0, this.attackCooldown - deltaTime);
            updateCooldownUI('attack', this.attackCooldown);
        }

        if (this.defenseCooldown > 0) {
            this.defenseCooldown = Math.max(0, this.defenseCooldown - deltaTime);
            updateCooldownUI('defense', this.defenseCooldown);
        }
    }

    // ç²å–ç•¶å‰é€Ÿåº¦å€ç‡
    getSpeedMultiplier() {
        const config = stateConfig[this.mode];
        return config ? config.speed : 1.0;
    }
}

// å…¨å±€ç©å®¶ç‹€æ…‹
const myPlayerState = new PlayerState();
```

### ç¢°æ’æª¢æ¸¬èˆ‡è™•ç†
```javascript
// æª¢æ¸¬ä¸¦è™•ç†ç¢°æ’
async function handleCollisions() {
    const players = Object.entries(gameState.players);

    for (let i = 0; i < players.length; i++) {
        const [id1, player1] = players[i];

        // åªè™•ç†è‡ªå·±çš„ç¢°æ’
        if (id1 !== currentPlayerId) continue;

        for (let j = 0; j < players.length; j++) {
            if (i === j) continue;

            const [id2, player2] = players[j];

            // æª¢æ¸¬ä½ç½®é‡ç–Š
            if (player1.x === player2.x && player1.y === player2.y) {
                await processCollision(id1, player1, id2, player2);
            }
        }
    }
}

// è™•ç†ç¢°æ’é‚è¼¯
async function processCollision(id1, p1, id2, p2) {
    const mode1 = p1.mode || 'normal';
    const mode2 = p2.mode || 'normal';

    let result = null;

    // æ”»æ“Š vs æ™®é€š
    if (mode1 === 'attack' && mode2 === 'normal') {
        result = {
            winner: id1,
            loser: id2,
            scoreChange: Math.floor(p2.score * 0.3),
            effect: 'attack-hit'
        };
    }
    // æ”»æ“Š vs é˜²ç¦¦
    else if (mode1 === 'attack' && mode2 === 'defense') {
        result = {
            winner: id2,
            loser: id1,
            scoreChange: Math.floor(p1.score * 0.1),
            effect: 'defense-reflect'
        };
    }
    // æ”»æ“Š vs æ”»æ“Š
    else if (mode1 === 'attack' && mode2 === 'attack') {
        result = {
            winner: null,
            loser: null,
            scoreChange1: Math.floor(p1.score * 0.15),
            scoreChange2: Math.floor(p2.score * 0.15),
            effect: 'mutual-damage'
        };
    }
    // æ™®é€š vs æ™®é€šï¼ˆåˆ†æ•¸é«˜è€…ç²å‹ï¼‰
    else if (mode1 === 'normal' && mode2 === 'normal') {
        if (p1.score > p2.score) {
            result = {
                winner: id1,
                loser: id2,
                scoreChange: Math.floor(p2.score * 0.1),
                effect: 'normal-collision'
            };
        } else if (p2.score > p1.score) {
            result = {
                winner: id2,
                loser: id1,
                scoreChange: Math.floor(p1.score * 0.1),
                effect: 'normal-collision'
            };
        }
    }
    // å…¶ä»–æƒ…æ³ï¼ˆé˜²ç¦¦ vs æ™®é€šã€é˜²ç¦¦ vs é˜²ç¦¦ï¼‰
    else {
        result = {
            effect: 'bounce' // å½ˆé–‹
        };
    }

    // æ‡‰ç”¨çµæœ
    if (result) {
        await applyCollisionResult(result, p1, p2);
    }
}

// æ‡‰ç”¨ç¢°æ’çµæœ
async function applyCollisionResult(result, p1, p2) {
    const updates = {};

    if (result.winner && result.loser) {
        // å–®æ–¹ç²å‹
        const winnerRef = database.ref(`rooms/${currentRoomId}/players/${result.winner}`);
        const loserRef = database.ref(`rooms/${currentRoomId}/players/${result.loser}`);

        const winnerPlayer = result.winner === id1 ? p1 : p2;
        const loserPlayer = result.loser === id1 ? p1 : p2;

        await winnerRef.update({
            score: winnerPlayer.score + result.scoreChange
        });

        await loserRef.update({
            score: Math.max(0, loserPlayer.score - result.scoreChange)
        });

        // é¡¯ç¤ºæ•ˆæœ
        if (result.effect === 'attack-hit') {
            showAttackEffect(
                {x: winnerPlayer.x, y: winnerPlayer.y},
                {x: loserPlayer.x, y: loserPlayer.y},
                result.scoreChange
            );
        } else if (result.effect === 'defense-reflect') {
            showDefenseEffect(
                {x: p2.x, y: p2.y},
                {x: p1.x, y: p1.y}
            );
        }
    } else if (result.effect === 'mutual-damage') {
        // é›™æ–¹å‚·å®³
        await database.ref(`rooms/${currentRoomId}/players/${id1}`).update({
            score: Math.max(0, p1.score - result.scoreChange1)
        });

        await database.ref(`rooms/${currentRoomId}/players/${id2}`).update({
            score: Math.max(0, p2.score - result.scoreChange2)
        });

        showMutualDamage({x: p1.x, y: p1.y}, {x: p2.x, y: p2.y});
    } else if (result.effect === 'bounce') {
        // å½ˆé–‹
        playSound('bounce');
    }
}
```

### éµç›¤æ§åˆ¶æ•´åˆ
```javascript
document.addEventListener('keydown', (e) => {
    // æ”»æ“Šç‹€æ…‹
    if (e.key === 'q' || e.key === 'Q') {
        if (myPlayerState.switchToAttack()) {
            playSound('attack-activate');
            showNotification('æ”»æ“Šæ¨¡å¼å•Ÿå‹•ï¼', '#FF4444');
        } else {
            showNotification('æŠ€èƒ½å†·å»ä¸­...', '#999');
        }
    }

    // é˜²ç¦¦ç‹€æ…‹
    if (e.key === 'e' || e.key === 'E') {
        if (myPlayerState.switchToDefense()) {
            playSound('defense-activate');
            showNotification('é˜²ç¦¦æ¨¡å¼å•Ÿå‹•ï¼', '#4444FF');
        } else {
            showNotification('æŠ€èƒ½å†·å»ä¸­...', '#999');
        }
    }

    // å¿«é€Ÿåˆ‡å›æ™®é€š
    if (e.key === ' ') {
        myPlayerState.switchToNormal();
        showNotification('å–æ¶ˆç‹€æ…‹', '#FFD700');
    }
});
```

---

## ğŸ“Š å¹³è¡¡æ€§èª¿æ•´

### æ•¸å€¼é…ç½®è¡¨

| åƒæ•¸ | åˆå§‹å€¼ | èªªæ˜ | å¯èª¿æ•´ç¯„åœ |
|-----|-------|------|----------|
| æ”»æ“ŠæŒçºŒæ™‚é–“ | 5ç§’ | æ”»æ“Šç‹€æ…‹ç¶­æŒæ™‚é–“ | 3-8ç§’ |
| æ”»æ“Šå†·å»æ™‚é–“ | 10ç§’ | æ”»æ“Šå¾Œéœ€ç­‰å¾…æ™‚é–“ | 8-15ç§’ |
| æ”»æ“Šé€Ÿåº¦åŠ æˆ | +20% | æ”»æ“Šç‹€æ…‹ç§»å‹•é€Ÿåº¦ | +10% ~ +30% |
| æ”»æ“Šæ¶åˆ†æ¯”ä¾‹ | 30% | æ“Šä¸­æ™®é€šç©å®¶æ¶åˆ† | 20% ~ 50% |
| é˜²ç¦¦æŒçºŒæ™‚é–“ | 5ç§’ | é˜²ç¦¦ç‹€æ…‹ç¶­æŒæ™‚é–“ | 3-8ç§’ |
| é˜²ç¦¦å†·å»æ™‚é–“ | 8ç§’ | é˜²ç¦¦å¾Œéœ€ç­‰å¾…æ™‚é–“ | 6-12ç§’ |
| é˜²ç¦¦é€Ÿåº¦æ¸›å°‘ | -30% | é˜²ç¦¦ç‹€æ…‹ç§»å‹•é€Ÿåº¦ | -20% ~ -50% |
| é˜²ç¦¦åå½ˆå‚·å®³ | 10% | åå½ˆçµ¦æ”»æ“Šè€…çš„å‚·å®³ | 5% ~ 20% |
| äº’æ’å‚·å®³ | 15% | é›™æ–¹æ”»æ“Šç¢°æ’æå¤± | 10% ~ 25% |

### å»ºè­°æ¸¬è©¦æµç¨‹
```
1. ä½¿ç”¨åˆå§‹å€¼æ¸¬è©¦ 20 å±€
2. è¨˜éŒ„å„ç‹€æ…‹ä½¿ç”¨é »ç‡
3. è¨˜éŒ„å‹ç‡æ•¸æ“š
4. ä¾æ•¸æ“šèª¿æ•´ï¼š
   - å¦‚æœæ”»æ“Šå¤ªå¼· â†’ å¢åŠ å†·å»æˆ–æ¸›å°‘æ¶åˆ†
   - å¦‚æœé˜²ç¦¦å¤ªå¼± â†’ å¢åŠ åå½ˆå‚·å®³æˆ–æ¸›å°‘é€Ÿåº¦æ‡²ç½°
   - å¦‚æœäº’æ’å¤ªå°‘ â†’ å¢åŠ æ”»æ“Šçå‹µæˆ–æ¸›å°‘å†·å»
5. é‡è¤‡æ¸¬è©¦ç›´åˆ°å¹³è¡¡
```

---

## ğŸ¯ èˆ‡éŠæˆ²æ¨¡å¼æ•´åˆ

### é©ç”¨æ¨¡å¼

âœ… **è¨ˆæ™‚ç«¶é€Ÿè³½**ï¼šå®Œç¾å¥‘åˆï¼Œå¢åŠ ç«¶çˆ­æ€§
âœ… **ç”Ÿå­˜æ·˜æ±°è³½**ï¼šæ”»æ“Šæ›´è‡´å‘½ï¼ˆç›´æ¥æ‰£å‘½ï¼‰
âœ… **åœ˜éšŠå°æŠ—è³½**ï¼šå¯ä»¥ä¿è­·éšŠå‹ï¼ˆé˜²ç¦¦æ“‹åˆ€ï¼‰
âœ… **å¯¶ç®±çˆ­å¥ªæˆ°**ï¼šæ¶å¯¶ç®±æ™‚æ”»é˜²åšå¼ˆ
âŒ **è¿½é€æ¨¡å¼**ï¼šå·²æœ‰èƒ½é‡è±†æ©Ÿåˆ¶ï¼Œä¸éœ€è¦

### æ¨¡å¼å°ˆå±¬èª¿æ•´

**ç”Ÿå­˜æ·˜æ±°è³½ç‰ˆæœ¬**ï¼š
```javascript
// æ”»æ“ŠæˆåŠŸç›´æ¥æ‰£å‘½
if (mode1 === 'attack' && mode2 === 'normal') {
    result = {
        winner: id1,
        loser: id2,
        livesLost: 1,  // æ‰£1æ¢å‘½
        effect: 'attack-kill'
    };
}
```

**åœ˜éšŠå°æŠ—è³½ç‰ˆæœ¬**ï¼š
```javascript
// éšŠå‹ä¹‹é–“ç„¡æ³•å‚·å®³
if (p1.team === p2.team) {
    return; // ä¸è™•ç†ç¢°æ’
}

// é˜²ç¦¦å¯ä»¥ä¿è­·éšŠå‹
if (mode1 === 'defense' && p2.team === p1.team) {
    // p1 åœ¨ p2 æ—é‚Šæ™‚ï¼Œp2 ä¹Ÿç²å¾—è­·ç›¾æ•ˆæœ
    applyTeammateShield(p2);
}
```

---

## ğŸ’¡ é€²éšåŠŸèƒ½ï¼ˆæœªä¾†æ“´å±•ï¼‰

### 1. é€£æ“Šç³»çµ±
```
é€£çºŒæ”»æ“ŠæˆåŠŸå¯ç²å¾—é€£æ“ŠåŠ æˆï¼š
- 2é€£æ“Šï¼šæ¶åˆ† +10%
- 3é€£æ“Šï¼šæ¶åˆ† +20% + é€Ÿåº¦ +10%
- 5é€£æ“Šï¼šæ¶åˆ† +50% + ç„¡æ•µ1ç§’
- é€£æ“Šä¸­æ–·ï¼šè¢«æ”»æ“Šæˆ–10ç§’å…§æœªæ”»æ“Š
```

### 2. æŠ€èƒ½å‡ç´š
```
ç©å®¶ç­‰ç´šæå‡è§£é–æŠ€èƒ½å¼·åŒ–ï¼š
- Lv 10ï¼šæ”»æ“Šå†·å» -1ç§’
- Lv 20ï¼šé˜²ç¦¦æŒçºŒæ™‚é–“ +1ç§’
- Lv 30ï¼šæ”»æ“Šç¯„åœ +1æ ¼ï¼ˆå¯é ç¨‹æ”»æ“Šï¼‰
- Lv 40ï¼šé˜²ç¦¦åå½ˆå‚·å®³ +5%
```

### 3. ç‰¹æ®Šé“å…·
```
åœ°åœ–éš¨æ©Ÿåˆ·æ–°ç‰¹æ®Šé“å…·ï¼š
- ğŸ”¥ ç‹‚æš´è—¥æ°´ï¼šæ”»æ“Šå†·å» -50%ï¼ŒæŒçºŒ30ç§’
- ğŸ›¡ï¸ éµå£è—¥æ°´ï¼šé˜²ç¦¦ç„¡é€Ÿåº¦æ‡²ç½°ï¼ŒæŒçºŒ20ç§’
- âš¡ é–ƒé›»æ‰‹å¥—ï¼šæ”»æ“Šç¯„åœ +2æ ¼ï¼ŒæŒçºŒ15ç§’
- ğŸ’« ç„¡æ•µæ˜Ÿæ˜Ÿï¼š10ç§’ç„¡æ•µ
```

---

## ğŸ“ ç¸½çµ

é€™å€‹æˆ°é¬¥ç³»çµ±ï¼š
âœ… **ç°¡å–®æ˜“æ‡‚**ï¼šçŸ³é ­å‰ªåˆ€å¸ƒé‚è¼¯ï¼Œæ–°æ‰‹ç§’æ‡‚
âœ… **ç­–ç•¥æ·±åº¦**ï¼šä½•æ™‚æ”»æ“Šã€ä½•æ™‚é˜²å®ˆéœ€è¦åˆ¤æ–·
âœ… **è¦–è¦ºè¯éº—**ï¼šè±å¯Œçš„ç‰¹æ•ˆå’Œå‹•ç•«
âœ… **æ˜“æ–¼å¹³è¡¡**ï¼šæ‰€æœ‰æ•¸å€¼å¯èª¿æ•´
âœ… **æ“´å±•æ€§å¼·**ï¼šæœªä¾†å¯åŠ å…¥æ›´å¤šè®ŠåŒ–

**ä¸‹ä¸€æ­¥**ï¼šè¦ä¸è¦æˆ‘å¹«ä½ æŠŠé€™å€‹æˆ°é¬¥ç³»çµ±æ•´åˆé€²ç¬¬ä¸€å€‹æ¨¡å¼ã€Œè¨ˆæ™‚ç«¶é€Ÿè³½ã€ä¸­ï¼ŸğŸ®
